<!doctype html>
<html>
    <head>
        <title>Redoc</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700"
            rel="stylesheet"
        />
        <!-- Bootstrap CSS -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
            body {
                margin: 0;
                padding: 0;
            }
            /* Ensure Redoc content doesn't get hidden behind navbar */
            redoc {
                display: block;
                margin-top: 56px;
            }
        </style>
    </head>
    <body>
        <!-- Bootstrap Navbar -->
        <nav class="navbar navbar-dark bg-dark fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img
                        src="https://via.placeholder.com/40"
                        alt="Logo"
                        width="40"
                        height="40"
                        class="d-inline-block align-text-top"
                    />
                    KAPI
                </a>
                <!-- Dropdown for versions -->
                <div class="dropdown">
                    <button
                        class="btn btn-secondary dropdown-toggle"
                        type="button"
                        id="versionDropdown"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                    >
                        Select Version
                    </button>
                    <ul class="dropdown-menu" id="versionList"></ul>
                </div>
            </div>
        </nav>

        <!-- Redoc Component -->
        <redoc id="redoc-container"></redoc>

        <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            async function fetchVersions() {
                try {
                    const response = await fetch(
                        "https://raw.githubusercontent.com/mariolilliresearch/Kapi/refs/heads/main/version_input.json"
                    );
                    const data = await response.json();
                    const versions = data["kubernetes-version"];
                    const dropdownMenu = document.getElementById("versionList");

                    dropdownMenu.innerHTML = ""; // Clear existing items

                    versions.forEach((version) => {
                        const listItem = document.createElement("li");
                        const link = document.createElement("a");
                        link.className = "dropdown-item";
                        link.href = "#";
                        link.textContent = version;
                        link.onclick = () => updateRedoc(version);
                        listItem.appendChild(link);
                        dropdownMenu.appendChild(listItem);
                    });
                } catch (error) {
                    console.error("Error fetching versions:", error);
                }
            }

            function updateRedoc(version) {
                const redocContainer = document.getElementById("redoc-container");
                redocContainer.setAttribute(
                    "spec-url",
                    `https://raw.githubusercontent.com/mariolilliresearch/Kapi/refs/heads/main/${version}/spec.json`
                );

                // Re-render Redoc
                Redoc.init(
                    `https://raw.githubusercontent.com/mariolilliresearch/Kapi/refs/heads/main/${version}/spec.json`,
                    {},
                    redocContainer
                );

                // Update dropdown button text
                document.getElementById("versionDropdown").textContent = version;
            }

            // Fetch versions on page load
            fetchVersions();
        </script>
    </body>
</html>
